<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="Follow this procedure to install and configure the Blockbridge CSI driver with Kubernetes">
<meta name="keywords" content=" kubernetes,containers">
<title>Using Blockbridge Storage with Kubernetes | Blockbridge Knowledgebase</title>
<!-- Google Fonts -->
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans&display=swap">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto&display=swap">

<link rel="stylesheet" href="/css/syntax.css">

<link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
<!--<link rel="stylesheet" type="text/css" href="css/bootstrap.min.css">-->
<link rel="stylesheet" href="/css/modern-business.css">
<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<link rel="stylesheet" href="/css/customstyles.css">
<link rel="stylesheet" href="/css/sidebar.css">
<link rel="stylesheet" href="/css/boxshadowproperties.css">
<!-- most color styles are extracted out to here -->
<link rel="stylesheet" href="/css/theme-blockbridge.css">

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.4/jquery.min.js"></script>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
<script src="/js/jquery.navgoco.min.js"></script>


<!-- Latest compiled and minified JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<!-- Anchor.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/anchor-js/2.0.0/anchor.min.js"></script>
<script src="/js/toc.js"></script>
<script src="/js/customscripts.js"></script>

<link rel="shortcut icon" href="/images/bb-favicon.ico" type="image/png">

<script>var clicky_site_ids = clicky_site_ids || []; clicky_site_ids.push(101238799);</script>
<script async src="//static.getclicky.com/js"></script>

<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
<![endif]-->

    <script>
        $(document).ready(function() {
          // Initialize navgoco with default options
          $("#mysidebar").navgoco({
            caretHtml: '',
            accordion: false,
            openClass: 'active', // open
            save: false, // leave false or nav highlighting doesn't work right
            cookie: {
              name: 'navgoco',
              expires: false,
              path: '/'
            },
            slide: {
              duration: 400,
              easing: 'swing'
            }
          });

          $("#collapseAll").click(function(e) {
                e.preventDefault();
                $("#mysidebar").navgoco('toggle', false);
            });

            $("#expandAll").click(function(e) {
                e.preventDefault();
                $("#mysidebar").navgoco('toggle', true);
            });

        });

    </script>
    <script>
        $(function () {
            $('[data-toggle="tooltip"]').tooltip()
        })
    </script>
    <script>
        $(document).ready(function() {
            $("#tg-sb-link").click(function() {
                $("#tg-sb-sidebar").toggle();
                $("#tg-sb-content").toggleClass('col-md-9');
                $("#tg-sb-content").toggleClass('col-md-12');
                $("#tg-sb-icon").toggleClass('fa-toggle-on');
                $("#tg-sb-icon").toggleClass('fa-toggle-off');
            });
        });
    </script>
    

</head>
<body>
  <!-- Navigation -->
<nav class="navbar navbar-inverse navbar-fixed-top">
    <div class="container-fluid topnavlinks">
        <div class="navbar-header">
            <div class="navbar-brand"><svg class="bb-logo" width="100%" xmlns="http://www.w3.org/2000/svg" version="1.1" id="Layer_1" x="0px" y="0px" viewBox="0 0 346 40" enable-background="new 0 0 346 40" space="preserve">
  <path fill="#FFFFFF" d="M85.328613,31.876953L90.526855,0.72998h12.858887c2.340332,0,4.255859,0.209961,5.745117,0.62793 c1.489746,0.418457,2.739746,1.274414,3.750977,2.566895c1.010742,1.293457,1.515625,2.806641,1.515625,4.541016 c0,1.902344-0.600098,3.518066-1.800781,4.848633c-1.201172,1.331543-2.8125,2.225098-4.833496,2.681152 c3.419922,1.20166,5.129883,3.461426,5.129883,6.777832c0,2.416992-0.817383,4.540039-2.451172,6.365234 s-4.350586,2.738281-8.150391,2.738281H85.328613z M95.493652,24.986328h4.652832c1.444336,0,2.440918-0.304688,2.987793-0.913086 c0.547363-0.608398,0.821777-1.269531,0.821777-1.985352c0-0.881836-0.300781-1.59375-0.902344-2.132812 c-0.601074-0.540039-1.495117-0.810547-2.681641-0.810547h-3.90332L95.493652,24.986328z M97.557129,12.618652h3.563477 c2.847656,0,4.271484-0.943359,4.271484-2.82959c0-1.657715-1.127441-2.487305-3.382324-2.487305h-3.564941L97.557129,12.618652z"/>
  <path fill="#FFFFFF" d="M129.130859,0.72998l-5.196777,31.146973h-8.76123l5.19873-31.146973H129.130859z"/>
  <path fill="#FFFFFF" d="M140.753906,32.561523c-3.20752,0-5.901367-0.954102-8.08252-2.864258 c-2.181152-1.908203-3.271484-4.513672-3.271484-7.814453c0-3.970703,1.265137-7.23291,3.79541-9.788574 c2.530762-2.555664,5.726562-3.833496,9.587402-3.833496c3.526367,0,6.32666,1,8.401367,3 c2.075195,2.000977,3.112305,4.469238,3.112305,7.405273c0,4.365234-1.333984,7.772461-4.000977,10.22168 C147.627441,31.336914,144.447266,32.561523,140.753906,32.561523z M141.118652,26.948242 c1.595703,0,2.678711-1.186523,3.248535-3.55957c0.570312-2.373047,0.855469-4.357422,0.855469-5.956055 c0-2.433105-0.882324-3.650879-2.64502-3.650879c-1.56543,0-2.648438,1.213867-3.249023,3.640137 c-0.600586,2.426758-0.900879,4.408203-0.900879,5.943359C138.427734,25.754883,139.324707,26.948242,141.118652,26.948242z"/>
  <path fill="#FFFFFF" d="M171.578125,22.932617l6.953125,1.710938c-1.246094,2.981445-2.880859,5.046875-4.900879,6.195312 c-2.021973,1.147461-4.111816,1.722656-6.27002,1.722656c-3.176758,0-5.771973-1.008789-7.786133-3.026367 c-2.013672-2.017578-3.020508-4.610352-3.020508-7.776367c0-3.608398,1.188965-6.79834,3.567871-9.570312 c2.378906-2.77002,5.528809-4.156738,9.450195-4.156738c2.842285,0,5.251465,0.855957,7.227051,2.567871 c1.975586,1.710938,2.963867,3.912598,2.963867,6.605469l-7.819824,0.913086c0-2.494629-0.843262-3.742188-2.530273-3.742188 c-1.444336,0-2.470215,1.021484-3.078125,3.063477s-0.912109,3.825195-0.912109,5.349609 c0,2.255859,0.851074,3.383789,2.553711,3.383789C169.647949,26.172852,170.848633,25.092773,171.578125,22.932617z"/>
  <path fill="#FFFFFF" d="M208.717773,8.836426l-4.012695,3.602051c-2.220703,1.990234-3.77832,3.441895-4.675781,4.353516 l5.541992,15.084961h-8.745117l-3.182617-9.854492l-3.962891,3.580078l-1.051758,6.274414h-8.113281l5.198242-31.146973h8.134766 l-2.888672,17.239746l1.666016-1.666016c0.500977-0.533203,0.926758-0.958984,1.275391-1.279297l6.775391-6.187988H208.717773z"/>
  <path fill="#FFFFFF" d="M221.697266,0.72998l-1.841797,10.977539c1.200195-1.430664,2.269531-2.374023,3.210938-2.830078 c0.941406-0.456543,1.998047-0.685547,3.167969-0.685547c2.216797,0,3.993164,0.787109,5.330078,2.361816 c1.335938,1.574219,2.004883,3.898438,2.004883,6.970703c0,3.773438-1.056641,7.195312-3.168945,10.268555 c-2.112305,3.072266-5.043945,4.608398-8.796875,4.608398c-3.555664,0-6.032227-1.459961-7.429688-4.380859l-2.579102,3.856445 h-3.994141l5.199219-31.146973H221.697266z M217.824219,23.800781c0,0.851562,0.060547,1.4375,0.182617,1.756836 c0.12207,0.318359,0.387695,0.623047,0.796875,0.912109s0.917969,0.432617,1.524414,0.432617 c0.774414,0,1.438477-0.253906,1.992188-0.764648c0.554688-0.508789,1.085938-1.638672,1.59375-3.387695 c0.508789-1.75,0.763672-3.613281,0.763672-5.59082c0-2.296387-0.802734-3.445312-2.40918-3.445312 c-1.545898,0-2.65918,1.172852-3.34082,3.517578L217.824219,23.800781z"/>
  <path fill="#FFFFFF" d="M238.8125,8.831055h7.674805l-0.919922,5.55957c1.598633-4.163574,4.042969-6.244141,7.333008-6.244141 c0.258789,0,0.616211,0.037598,1.073242,0.114258l-1.025391,8.214844c-0.791016-0.046875-1.31543-0.069336-1.574219-0.069336 c-1.900391,0-3.294922,0.445312-4.18457,1.333984s-1.523438,2.463867-1.901367,4.726562l-1.567383,9.410156h-8.761719 L238.8125,8.831055z"/>
  <path fill="#FFFFFF" d="M266.025391,8.831055l-3.857422,23.045898h-8.945312l3.857422-23.045898H266.025391z M267.503906,0 l-1.134766,6.777344h-8.946289L258.556641,0H267.503906z"/>
  <path fill="#FFFFFF" d="M294.807617,0.72998l-5.198242,31.146973h-8.181641l0.564453-3.485352 c-1.884766,2.780273-4.164062,4.169922-6.838867,4.169922c-2.082031,0-3.875-0.821289-5.379883-2.464844 c-1.503906-1.642578-2.256836-3.993164-2.256836-7.049805c0-3.789062,1.041992-7.210449,3.125977-10.269043 c2.083008-3.056641,4.751953-4.585938,8.006836-4.585938c2.783203,0,4.660156,1.096191,5.633789,3.287598l1.787109-10.749512 H294.807617z M283.329102,17.021484c0.044922-0.243164,0.067383-0.50293,0.067383-0.776855 c0-0.65332-0.232422-1.20752-0.695312-1.663574c-0.461914-0.456543-1.019531-0.68457-1.672852-0.68457 c-1.5625,0-2.688477,1.205566-3.378906,3.616211c-0.69043,2.412109-1.035156,4.416016-1.035156,6.012695 c0,2.099609,0.814453,3.149414,2.444336,3.149414c1.614258,0,2.6875-1.048828,3.220703-3.147461L283.329102,17.021484z"/>
  <path fill="#FFFFFF" d="M320.798828,2.281738l-0.547852,5.75c-0.911133-0.105469-1.595703-0.15918-2.051758-0.15918 c-1.686523,0-2.834961,0.615723-3.442383,1.848633c2.356445,1.414062,3.53418,3.247559,3.53418,5.498535 c0,1.962891-0.766602,3.705078-2.299805,5.224609c-1.533203,1.521484-4.348633,2.282227-8.446289,2.282227 c-0.866211,0-1.579102-0.030273-2.140625-0.09082c-0.819336-0.091797-1.396484-0.136719-1.729492-0.136719 c-0.554688,0-1.010742,0.162109-1.37207,0.487305s-0.541016,0.699219-0.541016,1.121094 c0,0.363281,0.121094,0.65625,0.364258,0.882812s0.524414,0.359375,0.84375,0.395508 c0.319336,0.039062,1.686523,0.094727,4.104492,0.169922c2.644531,0.092773,4.357422,0.1875,5.140625,0.287109 c0.783203,0.098633,1.645508,0.400391,2.587891,0.902344c0.941406,0.50293,1.683594,1.208008,2.222656,2.114258 s0.80957,1.922852,0.80957,3.050781c0,2.163086-0.958008,4.052734-2.873047,5.667969 C313.046875,39.192383,309.421875,40,304.086914,40c-8.071289,0-12.106445-1.856445-12.106445-5.567383 c0-1.931641,1.37207-3.415039,4.117188-4.449219c-1.483398-0.989258-2.224609-2.213867-2.224609-3.673828 c0-2.555664,1.864258-4.373047,5.594727-5.453125c-2.134766-1.202148-3.201172-2.913086-3.201172-5.134766 c0-2.022949,0.880859-3.772461,2.644531-5.248047c1.763672-1.474609,4.727539-2.212891,8.891602-2.212891 c1.277344,0,2.470703,0.11377,3.580078,0.341797c0.65332-4.304688,3.009766-6.457031,7.068359-6.457031 C319.058594,2.145508,319.841797,2.19043,320.798828,2.281738z M300.527344,31.876953 c-0.865234,0.516602-1.296875,1.049805-1.296875,1.59668c0,1.15625,1.896484,1.734375,5.688477,1.734375 c1.865234,0,3.21875-0.118164,4.061523-0.353516c0.84082-0.235352,1.261719-0.696289,1.261719-1.380859 c0-0.456055-0.197266-0.756836-0.59082-0.901367c-0.395508-0.143555-1.251953-0.24707-2.571289-0.306641 C303.256836,32.09668,301.073242,31.967773,300.527344,31.876953z M307.154297,18.574219 c0.96875,0,1.729492-0.342773,2.282227-1.027344s0.828125-1.459961,0.828125-2.327148 c0-1.688477-0.832031-2.533203-2.49707-2.533203c-1.029297,0-1.813477,0.351074-2.350586,1.050781 s-0.805664,1.52832-0.805664,2.486328c0,0.745117,0.242188,1.323242,0.726562,1.734375S306.427734,18.574219,307.154297,18.574219z"/>
  <path fill="#FFFFFF" d="M345.650391,22.042969h-15.868164c-0.076172,0.625977-0.114258,1.092773-0.114258,1.397461 c0,1.008789,0.323242,1.796875,0.96875,2.362305c0.645508,0.566406,1.462891,0.848633,2.451172,0.848633 c1.869141,0,3.191406-0.972656,3.966797-2.920898l7.751953,1.255859c-1.00293,2.256836-2.625977,4.084961-4.868164,5.480469 c-2.241211,1.396484-4.730469,2.094727-7.466797,2.094727c-3.43457,0-6.220703-0.976562-8.355469-2.931641 c-2.135742-1.955078-3.204102-4.621094-3.204102-7.999023c0-3.665039,1.262695-6.810547,3.786133-9.434082 c2.522461-2.624512,5.821289-3.936035,9.894531-3.936035c3.450195,0,6.197266,1.01709,8.242188,3.052246 c2.043945,2.035156,3.06543,4.737793,3.06543,8.109863C345.900391,20.182617,345.816406,21.055664,345.650391,22.042969z M337.350586,17.615234c0.076172-0.470703,0.115234-0.835938,0.115234-1.094727c0-0.821777-0.255859-1.536133-0.763672-2.144531 c-0.510742-0.608398-1.220703-0.912598-2.132812-0.912598c-0.972656,0-1.853516,0.368164-2.644531,1.106445 s-1.276367,1.753418-1.458984,3.04541H337.350586z"/>
  <path fill-rule="evenodd" clip-rule="evenodd" fill="#4F8CCA" d="M34.401367,0.722168h22.350098c0,0,1.194336,0,1.15625,1.239258 L53.055664,30.75c-0.20752,1.061523-1.129395,1.125977-1.129395,1.125977h-22.41748c0,0-1.026367,0-0.961914-1.219727 l4.873047-28.866211C33.411133,0.790039,34.401367,0.722168,34.401367,0.722168z"/>
  <path fill-rule="evenodd" clip-rule="evenodd" fill="#6AA9DC" d="M62.686035,0.722168h22.350098c0,0,1.194336,0,1.15625,1.239258 L81.34082,30.75c-0.20752,1.061523-1.129883,1.125977-1.129883,1.125977H57.793945c0,0-1.026855,0-0.961914-1.219727 l4.873047-28.866211C61.696289,0.790039,62.686035,0.722168,62.686035,0.722168z"/>
  <path fill-rule="evenodd" clip-rule="evenodd" fill="#3B6BA0" d="M5.856934,0.722168h22.350098c0,0,1.194336,0,1.15625,1.239258 L24.511719,30.75c-0.20752,1.061523-1.129883,1.125977-1.129883,1.125977H0.964844c0,0-1.026855,0-0.961914-1.219727 L4.875977,1.790039C4.867188,0.790039,5.856934,0.722168,5.856934,0.722168z"/>
</svg></div>
        </div>
    </div>
    <!-- /.container -->
</nav>


  <!-- Page Content -->
  <div class="container-fluid">
    <div id="main">
      <!-- Content Row -->
      <div class="row">

        <div class="col-body">
          <!-- row-oriented flex container -->
          

          <!-- Sidebar Column -->
          <nav class="col-nav hidden-sm hidden-xs" id="tg-sb-sidebar">
            

<ul id="sidebar" class="sidebar">
  
  
  
  
  <li>
      <a href="#summary">ABOUT THIS GUIDE</a>
      <ul>
          
          
          
          <li><a href="#blockbridge-driver-capabilities">Blockbridge Driver Capabilities</a></li>
          
          
          
          
          
          
          <li><a href="#supported-kubernetes-environments">Supported Kubernetes Environments</a></li>
          
          
          
          
          
          
          <li><a href="#requirements">Requirements</a></li>
          
          
          
          
      </ul>
   </li>
     
      
  
  <li>
      <a href="#blockbridge-driver-configuration">Blockbridge Backend Configuration</a>
      <ul>
          
          
          
          <li><a href="#create-a-blockbridge-account-to-provision-volumes-for-kubernetes">Create a Kubernetes tenant account</a></li>
          
          
          
          
          
          
          <li><a href="#create-an-authorization-access-token-for-the-blockbridge-volume-driver">Create a persistent authorization</a></li>
          
          
          
          
      </ul>
   </li>
     
      
  
  <li>
      <a href="#driver-installation-in-kubernetes">Kubernetes Driver Installation</a>
      <ul>
          
          
          
          <li><a href="#authenticate-to-kubernetes">Authenticate to Kubernetes</a></li>
          
          
          
          
          
          
          <li><a href="#create-a-secret">Create a secret</a></li>
          
          
          
          
          
          
          <li><a href="#deploy-the-blockbridge-driver">Deploy the Blockbridge driver</a></li>
          
          
          
          
          
          
          <li><a href="#ensure-driver-is-operational">Verify the driver installation</a></li>
          
          
          
          
          
          
          <li><a href="#storage-classes">Configure storage classes</a></li>
          
          
          
          
          
          
          <li><a href="#test-and-verify-persistentvolumeclaim">Test: Create a Persistent Volume Claim</a></li>
          
          
          
          
          
          
          <li><a href="#test-and-verify-application">Test: Deploy an application</a></li>
          
          
          
          
          
          
          <li><a href="#test-and-verify-write-data">Test: Write persistent data</a></li>
          
          
          
          
      </ul>
   </li>
     
      
  
  <li>
      <a href="#troubleshooting">Troubleshooting</a>
      <ul>
          
      </ul>
   </li>
     
      
      
      <!-- if you aren't using the accordion, uncomment this block:
         <p class="external">
             <a href="#" id="collapseAll">Collapse All</a> | <a href="#" id="expandAll">Expand All</a>
         </p>
         -->
</ul>

<!-- this highlights the active parent class in the navgoco sidebar. this is critical so that the parent expands when you're viewing a page. This must appear below the sidebar code above. Otherwise, if placed inside customscripts.js, the script runs before the sidebar code runs and the class never gets inserted.-->
<script>$("li.active").parents('li').toggleClass("active");</script>

          </nav>
          

          <!-- Content Column -->
          <main class="col-content">
            <div class="post-header">
   <h1 class="post-title-main">Using Blockbridge Storage with Kubernetes</h1>
</div>



<div class="post-content">

   

    


    

   <h2 id="summary">Summary</h2>

<p>Blockbridge provides a Container Storage Interface (<a href="https://github.com/container-storage-interface/spec">CSI</a>) driver to deliver persistent, secure, multi-tenant, cluster-accessible storage for <a href="https://kubernetes-csi.github.io/docs/">Kubernetes</a>. Deploy the Blockbridge CSI driver in your Kubernetes cluster using standard kubectl commands.</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">Blockbridge Driver</th>
      <th style="text-align: left">CSI Version</th>
      <th style="text-align: left">stability</th>
      <th style="text-align: left">kubernetes version</th>
      <th style="text-align: left">Deploy URL</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">0.2.0</td>
      <td style="text-align: left">0.2.0</td>
      <td style="text-align: left">beta</td>
      <td style="text-align: left">v1.10, v1.11</td>
      <td style="text-align: left">https://get.blockbridge.com/kubernetes/deploy/csi/v0.2.0/csi-blockbridge.yaml</td>
    </tr>
    <tr>
      <td style="text-align: left">1.0.0</td>
      <td style="text-align: left">1.0.0</td>
      <td style="text-align: left">GA</td>
      <td style="text-align: left">v1.14+</td>
      <td style="text-align: left">https://get.blockbridge.com/kubernetes/deploy/csi/v1.0.0/csi-blockbridge.yaml</td>
    </tr>
  </tbody>
</table>

<p>As of Kubernetes version 1.14, Blockbridge supports CSI specification version 1.0.0, with Blockbridge driver version 1.0.0, as Generally Available (GA).</p>

<p>NOTE: If using an older version of the Blockbridge driver, please see the appropriate matching README file for version specific instructions.</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">Blockbridge Driver</th>
      <th style="text-align: left">README version</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">0.2.0</td>
      <td style="text-align: left"><a href="README.v0.2.0.md">README.v0.2.0.md</a></td>
    </tr>
    <tr>
      <td style="text-align: left">1.0.0</td>
      <td style="text-align: left"><a href="README.md">README.md (this version)</a></td>
    </tr>
  </tbody>
</table>

<h2 id="blockbridge-driver-capabilities">Blockbridge Driver Capabilities</h2>

<ul>
  <li>Dynamic volume provisioning</li>
  <li>Automatic volume failover and mobility across the cluster</li>
  <li>Integration with RBAC for multi-namespace, multi-tenant deployments</li>
  <li>Quality of Service</li>
  <li>Encryption in-flight for control (always) and data (optional)</li>
  <li>Encryption at rest</li>
  <li>Multiple Storage Classes provide programmable, deterministic storage characteristics</li>
</ul>

<h2 id="supported-kubernetes-environments">Supported Kubernetes environments</h2>

<ul>
  <li>Docker Enterprise Edition 3 (Docker EE 3.0)</li>
  <li>Rancher 2.X (Rancher kubernetes engine)</li>
</ul>

<h2 id="requirements">Requirements</h2>

<p>The following minimum requirements must be met to use the Blockbridge driver in Kubernetes:</p>

<ul>
  <li>Kubernetes version 1.14 minimum</li>
  <li><code class="highlighter-rouge">--allow-privileged</code> flag must be set to true for both the API server and the
kubelet</li>
  <li>MountPropagation must be enabled (default to true since version 1.10)</li>
  <li>(if you use Docker) the Docker daemon of the cluster nodes must allow shared
mounts</li>
</ul>

<p>See <a href="https://kubernetes-csi.github.io/docs/deploying.html">CSI Deploying</a> for more information.</p>

<h2 id="blockbridge-driver-configuration">Blockbridge Driver Configuration</h2>

<p>The driver is configured with two pieces of information:</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">configuration</th>
      <th style="text-align: left">description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">BLOCKBRIDGE_API_URL</td>
      <td style="text-align: left">Blockbridge controlplane API endpoint URL specified as <code class="highlighter-rouge">https://hostname.example/api</code></td>
    </tr>
    <tr>
      <td style="text-align: left">BLOCKBRIDGE_API_KEY</td>
      <td style="text-align: left">Blockbridge controlplane access token</td>
    </tr>
  </tbody>
</table>

<p>The API endpoint is specified as a URL, and points to the Blockbridge
controlplane. The access token authenticates the driver with the Blockbridge
controlplane.</p>

<h3 id="create-a-blockbridge-account-to-provision-volumes-for-kubernetes">Create a Blockbridge account to provision volumes for Kubernetes</h3>

<p><em>NOTE: This guide assumes that the Blockbridge controlplane is running and a system password has been set. For help setting up the Blockbridge controlplane, please contact <a href="mailto:support@blockbridge.com">Blockbridge Support</a>.</em></p>

<p>Create an account to hold the volumes for Kubernetes.</p>

<p>Use the Blockbridge CLI to create the account.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ export BLOCKBRIDGE_API_HOST=blockbridge.mycompany.example
$ docker run --rm -it -e BLOCKBRIDGE_API_HOST docker.io/blockbridge/cli:latest-alpine bb --no-ssl-verify-peer account create --name kubernetes --password
</code></pre></div></div>

<p>When prompted, first enter the password for the new <strong>kubernetes</strong> account:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Enter password: 
</code></pre></div></div>

<p>When prompted, then authenticate to the Blockbridge controlplane as the system user:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Authenticating to https://blockbridge.mycompany.example/api

Enter user or access token: system
Password for system: 
Authenticated; token expires in 3599 seconds.
</code></pre></div></div>

<p>The account is created:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>== Created account: kubernetes (ACT0762194C40656F03)

== Account: kubernetes (ACT0762194C40656F03)
name                  kubernetes
label                 kubernetes        
serial                ACT0762194C40656F03      
created               2018-11-19 16:15:15 +0000
disabled              no                       
</code></pre></div></div>

<h3 id="create-an-authorization-access-token-for-the-blockbridge-volume-driver">Create an authorization (access token) for the Blockbridge volume driver</h3>

<p>Create an access token in the new <strong>kubernetes</strong> account for use as authentication for the volume driver.</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ export BLOCKBRIDGE_API_HOST=blockbridge.mycompany.example
$ docker run --rm -it -e BLOCKBRIDGE_API_HOST docker.io/blockbridge/cli:latest-alpine bb --no-ssl-verify-peer authorization create
</code></pre></div></div>

<p>Authenticate using the new <strong>kubernetes</strong> account username and password.</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Authenticating to https://blockbridge.mycompany.example/api

Enter user or access token: kubernetes
Password for kubernetes: 
Authenticated; token expires in 3599 seconds.
</code></pre></div></div>

<p>The authorization (access token) is created.</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>== Created authorization: ATH4762194C4062668E

== Authorization: ATH4762194C4062668E
serial                ATH4762194C4062668E                    
account               kubernetes (ACT0762194C40656F03)
user                  kubernetes (USR1B62194C40656FBD)
enabled               yes                                    
created at            2018-11-19 11:15:47 -0500              
access type           online                                 
token suffix          ot50v2vA                               
restrict              auth                                   
enforce 2-factor      false                                  

== Access Token
access token          1/Nr7qLedL/P0KXxbrB8+jpfrFPBrNi3X+8H9BBwyOYg/mvOot50v2vA

*** Remember to record your access token!
</code></pre></div></div>

<p>Make a note of the access token. Use this as the BLOCKBRIDGE_API_KEY during the Blockbridge volume driver installation.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ export BLOCKBRIDGE_API_KEY="1/Nr7qLedL/P0KXxbrB8+jpfrFPBrNi3X+8H9BBwyOYg/mvOot50v2vA"
</code></pre></div></div>

<h2 id="driver-installation-in-kubernetes">Driver installation in Kubernetes</h2>

<h3 id="authenticate-to-kubernetes">Authenticate to Kubernetes</h3>

<p><strong>Authenticate with your Kubernetes cluster.</strong></p>

<p>Ensure you are authenticated to your Kubernetes cluster. A version will be printed for both the client and server successfully.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ kubectl version
Client Version: version.Info{Major:"1", Minor:"14", GitVersion:"v1.14.2", GitCommit:"66049e3b21efe110454d67df4fa62b08ea79a19b", GitTreeState:"clean", BuildDate:"2019-05-16T16:23:09Z", GoVersion:"go1.12.5", Compiler:"gc", Platform:"linux/amd64"}
Server Version: version.Info{Major:"1", Minor:"14+", GitVersion:"v1.14.3-docker-2", GitCommit:"7cfcb52617bf94c36953159ee9a2bf14c7fcc7ba", GitTreeState:"clean", BuildDate:"2019-06-06T16:18:13Z", GoVersion:"go1.12.5", Compiler:"gc", Platform:"linux/amd64"}
</code></pre></div></div>

<p>NOTE: setting up <code class="highlighter-rouge">kubectl</code> authentication is beyond the scope of this guide. Please refer to your specific instructions for the Kubernetes service or installation you are using.</p>

<h3 id="create-a-secret">Create a secret</h3>

<p>Create a secret containing the Blockbridge API endpoint URL and access token.</p>

<p>Use BLOCKBRIDGE_API_HOST and BLOCKBRIDGE_API_KEY with the correct values for the Blockbridge controlplane, using the access token created in the <strong>kubernetes</strong> account.</p>

<p><em>NOTE: While control traffic is always encrypted, we specify here to disable peer certificate verification using the <code class="highlighter-rouge">ssl-verify-peer</code> flag. This setting implicitly trusts the default controlplane self-signed certificate. Configuring certificate verification, including specifying custom-supplied CA certificates, is beyond the scope of this guide. Please contact <a href="mailto:support@blockbridge.com">Blockbridge Support</a> for more information.</em></p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ cat &gt; secret.yml &lt;&lt;- EOF
apiVersion: v1
kind: Secret
metadata:
  name: blockbridge
  namespace: kube-system
stringData:
  api-url: "https://${BLOCKBRIDGE_API_HOST}/api"
  access-token: "$BLOCKBRIDGE_API_KEY"
  ssl-verify-peer: "false"
EOF
</code></pre></div></div>

<p>Example:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ cat secret.yml
apiVersion: v1
kind: Secret
metadata:
  name: blockbridge
  namespace: kube-system
stringData:
  api-url: "https://blockbridge.mycompany.example/api"
  access-token: "1/Nr7qLedL/P0KXxbrB8+jpfrFPBrNi3X+8H9BBwyOYg/mvOot50v2vA"
  ssl-verify-peer: "false"
</code></pre></div></div>

<p>Create the secret in Kubernetes:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ kubectl create -f ./secret.yml
secret "blockbridge" created
</code></pre></div></div>

<p>Ensure the secret exists in the <code class="highlighter-rouge">kube-system</code> namespace:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ kubectl -n kube-system get secrets blockbridge
NAME          TYPE      DATA      AGE
blockbridge   Opaque    3         2m
</code></pre></div></div>

<h3 id="deploy-the-blockbridge-driver">Deploy the Blockbridge Driver</h3>

<p>Deploy the Blockbridge Driver as a DaemonSet / StatefulSet using <code class="highlighter-rouge">kubectl</code>.</p>

<p>NOTE: Choose a specific version as needed for your environment.</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">Blockbridge Driver</th>
      <th style="text-align: left">CSI Version</th>
      <th style="text-align: left">stability</th>
      <th style="text-align: left">kubernetes version</th>
      <th style="text-align: left">Deploy URL</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">0.2.0</td>
      <td style="text-align: left">0.2.0</td>
      <td style="text-align: left">beta</td>
      <td style="text-align: left">v1.10, v1.11</td>
      <td style="text-align: left">https://get.blockbridge.com/kubernetes/deploy/csi/v0.2.0/csi-blockbridge.yaml</td>
    </tr>
    <tr>
      <td style="text-align: left">1.0.0</td>
      <td style="text-align: left">1.0.0</td>
      <td style="text-align: left">GA</td>
      <td style="text-align: left">v1.14+</td>
      <td style="text-align: left">https://get.blockbridge.com/kubernetes/deploy/csi/v1.0.0/csi-blockbridge.yaml</td>
    </tr>
  </tbody>
</table>

<p>Apply the appropriate version of the driver:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ kubectl apply -f https://get.blockbridge.com/kubernetes/deploy/csi/v1.0.0/csi-blockbridge.yaml
</code></pre></div></div>

<p>Confirm everything was created:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>csidriver.storage.k8s.io/eps.csi.blockbridge.com created
storageclass.storage.k8s.io/blockbridge-gp created
storageclass.storage.k8s.io/blockbridge-tls created
statefulset.apps/csi-blockbridge-controller created
serviceaccount/csi-blockbridge-controller-sa created
clusterrole.rbac.authorization.k8s.io/csi-blockbridge-provisioner-role created
clusterrolebinding.rbac.authorization.k8s.io/csi-blockbridge-provisioner-binding created
clusterrole.rbac.authorization.k8s.io/csi-blockbridge-attacher-role created
clusterrolebinding.rbac.authorization.k8s.io/csi-blockbridge-attacher-binding created
daemonset.apps/csi-blockbridge-node created
serviceaccount/csi-blockbridge-node-sa created
clusterrole.rbac.authorization.k8s.io/csi-blockbridge-node-driver-registrar-role created
clusterrolebinding.rbac.authorization.k8s.io/csi-blockbridge-node-driver-registrar-binding created
</code></pre></div></div>

<p>The Blockbridge CSI Driver is deployed using the <a href="https://github.com/kubernetes/community/blob/master/contributors/design-proposals/storage/container-storage-interface.md#recommended-mechanism-for-deploying-csi-drivers-on-kubernetes">recommended mechanism</a> of deploying CSI drivers on Kubernetes.</p>

<h3 id="ensure-driver-is-operational">Ensure Driver is Operational</h3>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ kubectl -n kube-system get pods -l role=csi-blockbridge
</code></pre></div></div>

<p>Blockbridge CSI pods are all Running:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ kubectl -n kube-system get pods -l role=csi-blockbridge
NAME                                    READY     STATUS    RESTARTS   AGE
csi-blockbridge-controller-0            3/3       Running   0          6s
csi-blockbridge-node-4679b              2/2       Running   0          5s
</code></pre></div></div>

<h3 id="storage-classes">Storage Classes</h3>

<p>A default “general purpose” StorageClass called <code class="highlighter-rouge">blockbridge-gp</code> is created. This is the <strong>default</strong> StorageClass for dynamic provisioning of storage volumes. The general purpose StorageClass provisions using the default Blockbridge storage template configured in the Blockbridge controlplane.</p>

<p>There are a variety of additional storage class configuration options available, including:</p>

<ol>
  <li>Using transport encryption (tls)</li>
  <li>Using a custom tag-based query</li>
  <li>Using a named service template</li>
  <li>Using explicitly specified provisioned IOPS</li>
</ol>

<p>Several example storage classes are shown in <code class="highlighter-rouge">csi-storageclass.yaml</code>. Download, edit, and apply additional storage classes as needed.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ curl -OsSL https://get.blockbridge.com/kubernetes/deploy/csi/v1.0.0/csi-storageclass.yaml
$ cat csi-storageclass.yaml
###########################################################
# StorageClass General Purpose (default)
#
# set default storage class with no additional parameters
###########################################################
---
kind: StorageClass
apiVersion: storage.k8s.io/v1
metadata:
  name: blockbridge-gp
  namespace: kube-system
  annotations:
    storageclass.kubernetes.io/is-default-class: "true"
provisioner: com.blockbridge.csi.eps
###########################################################
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ kubectl apply -f ./csi-storageclass.yaml
</code></pre></div></div>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>storageclass.storage.k8s.io "blockbridge-gp" configured
</code></pre></div></div>

<h3 id="test-and-verify-persistentvolumeclaim">Test and verify: PersistentVolumeClaim</h3>

<p>Blockbridge storage volumes are now available via Kubernetes persistent volume claims (PVC).</p>

<p>Create a PersistentVolumeClaim. This dynamically provisions a volume in Blockbridge and makes it accessible to applications.</p>

<p>Create the PVC:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ kubectl apply -f https://get.blockbridge.com/kubernetes/deploy/examples/csi-pvc.yaml
</code></pre></div></div>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>persistentvolumeclaim "csi-pvc-blockbridge" created
</code></pre></div></div>

<p>Alternatively, download the example volume yaml, modify as needed, and apply:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ curl -OsSL https://get.blockbridge.com/kubernetes/deploy/examples/csi-pvc.yaml
</code></pre></div></div>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ cat csi-pvc.yaml
---
apiVersion: v1
kind: PersistentVolumeClaim
metadata:
  name: csi-pvc-blockbridge-example
spec:
  accessModes:
  - ReadWriteOnce
  resources:
    requests:
      storage: 5Gi
  storageClassName: blockbridge-gp
</code></pre></div></div>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ kubectl apply -f ./csi-pvc.yaml
</code></pre></div></div>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>persistentvolumeclaim "csi-pvc-blockbridge" created
</code></pre></div></div>

<p>Ensure the PVC was created successfully:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ kubectl get pvc csi-pvc-blockbridge
</code></pre></div></div>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>NAME                  STATUS   VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS     AGE
csi-pvc-blockbridge   Bound    pvc-6cb93ab2-ec49-11e8-8b89-46facf8570bb   5Gi        RWO            blockbridge-gp   4s
</code></pre></div></div>

<h3 id="test-and-verify-application">Test and verify: Application</h3>

<p>Create a Pod (application) that utilizes the example volume. When the Pod is created, the volume will be attached, formatted and mounted, making it available to the specified application.</p>

<p>Create the application:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ kubectl apply -f https://get.blockbridge.com/kubernetes/deploy/examples/csi-app.yaml
</code></pre></div></div>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pod "blockbridge-demo" created
</code></pre></div></div>

<p>Alternatively, download the application yaml, modify as needed, and apply:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ curl -OsSL https://get.blockbridge.com/kubernetes/deploy/examples/csi-app.yaml
</code></pre></div></div>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ cat csi-app.yaml
---
kind: Pod
apiVersion: v1
metadata:
  name: blockbridge-demo
spec:
  containers:
    - name: my-frontend
      image: busybox
      volumeMounts:
      - mountPath: "/data"
        name: my-bb-volume
      command: [ "sleep", "1000000" ]
    - name: my-backend
      image: busybox
      volumeMounts:
      - mountPath: "/data"
        name: my-bb-volume
      command: [ "sleep", "1000000" ]
  volumes:
    - name: my-bb-volume
      persistentVolumeClaim:
        claimName: csi-pvc-blockbridge
</code></pre></div></div>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ kubectl apply -f ./csi-app.yaml
</code></pre></div></div>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>pod "blockbridge-demo" created
</code></pre></div></div>

<p>Check if the pod is running successfully:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ kubectl get pod blockbridge-demo
</code></pre></div></div>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>NAME               READY     STATUS    RESTARTS   AGE
blockbridge-demo   2/2       Running   0          13s
</code></pre></div></div>

<h3 id="test-and-verify-write-data">Test and Verify: Write Data</h3>

<p>Write inside the app container:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ kubectl exec -ti blockbridge-demo -c my-frontend /bin/sh
</code></pre></div></div>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/ # df /data
Filesystem           1K-blocks      Used Available Use% Mounted on
/dev/blockbridge/2f93beb2-61eb-456b-809e-22e27e4f73cf
                       5232608     33184   5199424   1% /data

/ # touch /data/hello-world
/ # exit
</code></pre></div></div>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ kubectl exec -ti blockbridge-demo -c my-backend /bin/sh
</code></pre></div></div>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>/ # ls /data
hello-world
</code></pre></div></div>

<h2 id="troubleshooting">Troubleshooting</h2>

<h3 id="app-stuck-in-containercreating-due-to-failed-mount">App stuck in ContainerCreating due to failed Mount</h3>

<h4 id="symptom">Symptom</h4>
<p>Check the app status</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ kubectl get pod/blockbridge-demo
NAME               READY   STATUS              RESTARTS   AGE
blockbridge-demo   0/2     ContainerCreating   0          20s

$ kubectl describe pod/blockbridge-dmo
Events:
  Type     Reason                  Age   From                            Message
  ----     ------                  ----  ----                            -------
  Normal   Scheduled               10s   default-scheduler               Successfully assigned default/blockbridge-demo to kubelet.localnet
  Normal   SuccessfulAttachVolume  10s   attachdetach-controller         AttachVolume.Attach succeeded for volume "pvc-71c37e84-b302-11e9-a93f-0242ac110003"
  Warning  FailedMount             1s    kubelet, kubelet.localnet       MountVolume.MountDevice failed for volume "pvc-71c37e84-b302-11e9-a93f-0242ac110003" : rpc error: code = Unknown desc = runtime_error: /etc/iscsi/initiatorname.iscsi not found; ensure 'iscsi-initiator-utils' is installed.
</code></pre></div></div>

<h4 id="resolution">Resolution</h4>

<ul>
  <li>Ensure the host running the kubelet has iSCSI client support installed on the host/node</li>
  <li>For CentOS/RHEL, install: <code class="highlighter-rouge">iscsi-initiator-utils</code> package on the host/node running the kubelet.
    <ul>
      <li><code class="highlighter-rouge">yum install iscsi-initiator-utils</code></li>
    </ul>
  </li>
  <li>For Ubuntu, install: <code class="highlighter-rouge">open-iscsi-utils</code> package on the host/node running the kubelet.
    <ul>
      <li><code class="highlighter-rouge">apt install open-iscsi-utils</code></li>
    </ul>
  </li>
  <li>Delete/re-create the application pod to retry</li>
</ul>

<h3 id="pvc-unauthorized">PVC unauthorized</h3>

<h4 id="symptom-1">Symptom</h4>
<p>Check the PVC describe output:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ kubectl describe pvc csi-pvc-blockbridge
</code></pre></div></div>

<p>Provisioning failed due to “unauthorized” because the authorization access token is not valid. Ensure the correct access token is entered in the secret.</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  Warning  ProvisioningFailed    6s (x2 over 19s)  com.blockbridge.csi.eps csi-provisioner-blockbridge-0 2caddb79-ec46-11e8-845d-465903922841  Failed to provision volume with StorageClass "blockbridge-gp": rpc error: code = Internal desc = unauthorized_error: unauthorized: unauthorized
</code></pre></div></div>

<h4 id="resolution-1">Resolution</h4>

<ul>
  <li>Edit <code class="highlighter-rouge">secret.yml</code> and ensure correct access token and API URL are set.</li>
  <li>delete secret: <code class="highlighter-rouge">kubectl delete -f secret.yml</code></li>
  <li>create secret: <code class="highlighter-rouge">kubectl create -f secret.yml</code></li>
  <li>remove old configuration:
    <ul>
      <li><code class="highlighter-rouge">kubectl delete -f https://get.blockbridge.com/kubernetes/deploy/examples/csi-pvc.yaml</code></li>
      <li><code class="highlighter-rouge">kubectl delete -f https://get.blockbridge.com/kubernetes/deploy/csi/v1.0.0/csi-blockbridge.yaml</code></li>
    </ul>
  </li>
  <li>re-apply configuration:
    <ul>
      <li><code class="highlighter-rouge">kubectl apply -f https://get.blockbridge.com/kubernetes/deploy/csi/v1.0.0/csi-blockbridge.yaml</code></li>
      <li><code class="highlighter-rouge">kubectl apply -f https://get.blockbridge.com/kubernetes/deploy/examples/csi-pvc.yaml</code></li>
    </ul>
  </li>
</ul>

<h3 id="pvc-storageclass-not-found">PVC StorageClass not found</h3>
<h4 id="symptom-2">Symptom</h4>
<p>Check the PVC describe output:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ kubectl describe pvc csi-pvc-blockbridge
</code></pre></div></div>

<p>Provisioning failed because the storage class specified was invalid.</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>  Warning  ProvisioningFailed  7s (x3 over 10s)  persistentvolume-controller  storageclass.storage.k8s.io "blockbridge-gp" not found
</code></pre></div></div>

<h4 id="resolution-2">Resolution</h4>
<p>Ensure the StorageClass exists with the same name.</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ kubectl get storageclass blockbridge-gp
Error from server (NotFound): storageclasses.storage.k8s.io "blockbridge-gp" not found
</code></pre></div></div>

<ul>
  <li>Create the storageclass:
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ kubectl apply -f https://get.blockbridge.com/kubernetes/deploy/csi/v1.0.0/csi-storageclass.yaml
</code></pre></div>    </div>
  </li>
  <li>Alternatively, download and edit the desired storageclass:
    <div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ curl -OsSL https://get.blockbridge.com/kubernetes/deploy/csi/v1.0.0/csi-storageclass.yaml
$ edit csi-storageclass.yaml
$ kubectl -f apply ./csi-storageclass.yaml
</code></pre></div>    </div>
  </li>
</ul>

<p>The PVC continues to retry and picks up the storage class change:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ kubectl get pvc
NAME                    STATUS    VOLUME                                     CAPACITY   ACCESS MODES   STORAGECLASS      AGE
csi-pvc-blockbridge     Bound     pvc-6cb93ab2-ec49-11e8-8b89-46facf8570bb   5Gi        RWO            blockbridge-gp     4s
</code></pre></div></div>

<h3 id="app-stuck-pending-cannot-find-persistent-volume-claim-pvc">APP stuck Pending cannot find Persistent Volume Claim (PVC)</h3>
<h4 id="symptom-3">Symptom</h4>
<p>The app is stuck in pending:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ kubectl get pod blockbridge-demo
NAME               READY     STATUS    RESTARTS   AGE
blockbridge-demo   0/2       Pending   0          14s
</code></pre></div></div>

<p>The PVC cannot be found:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ kubectl describe pod blockbridge-demo

Events:
  Type     Reason            Age                From               Message
  ----     ------            ----               ----               -------
  Warning  FailedScheduling  12s (x6 over 28s)  default-scheduler  persistentvolumeclaim "csi-pvc-blockbridge" not found
</code></pre></div></div>

<h4 id="resolution-3">Resolution</h4>
<p>Ensure the PVC is created and valid.</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ kubectl get pvc csi-pvc-blockbridge
Error from server (NotFound): persistentvolumeclaims "csi-pvc-blockbridge" not found
</code></pre></div></div>

<p>Create the PVC:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ kubectl apply -f https://get.blockbridge.com/kubernetes/deploy/examples/csi-pvc.yaml
persistentvolumeclaim "csi-pvc-blockbridge" created
</code></pre></div></div>

<p>App retries automatically and succeeds in starting:</p>
<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ kubectl describe pod blockbridge-demo
  Normal   Scheduled               8s                 default-scheduler                  Successfully assigned blockbridge-demo to aks-nodepool1-56242131-0
  Normal   SuccessfulAttachVolume  8s                 attachdetach-controller            AttachVolume.Attach succeeded for volume "pvc-5332e169-ec4f-11e8-8b89-46facf8570bb"
  Normal   SuccessfulMountVolume   8s                 kubelet, aks-nodepool1-56242131-0  MountVolume.SetUp succeeded for volume "default-token-bx8b9"
</code></pre></div></div>

<h2 id="where-to-go-from-here">Where to go from here</h2>

<p>Contact <a href="mailto:support@blockbridge.com">Blockbridge Support</a> for any additional information or troubleshooting help.</p>


    <div class="tags">
        
    </div>

</div>

<hr class="shaded"/>

<footer>
            <div class="row">
                <div class="col-lg-12 footer">
               &copy;2020 Blockbridge Networks LLC. All rights reserved. <br />
 Site last generated: Dec 8, 2020
                </div>
            </div>
</footer>


          </main>

          <!-- /.col-body -->
        </div>

        <!-- /.row -->
      </div>
      <!-- /#main -->
    </div>
  </div>

</body>

</html>
